<main class="p-4 space-y-6">
    <div id="section-citas" class="hidden">
        <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 px-2">PrÃ³ximas Citas (15 dÃ­as)</h3>
        <div id="visor-citas" class="flex gap-3 overflow-x-auto pb-2 no-scrollbar">
            </div>
    </div>

    <div id="visor" class="bg-slate-900 text-white p-6 rounded-[2.5rem] shadow-xl">
        <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-2">Ãšltimo registro</p>
        <div id="last-log" class="text-2xl font-black italic tracking-tighter">Esperando datos...</div>
    </div>

    <div class="grid grid-cols-4 gap-2">
        <button onclick="quickLog('ðŸ’¦ Pis')" class="bg-white p-4 rounded-2xl border shadow-sm flex flex-col items-center"><i class="fa-solid fa-droplet text-cyan-500 mb-1"></i><span class="text-[8px] font-bold">PIS</span></button>
        <button onclick="quickLog('ðŸ’© Caca')" class="bg-white p-4 rounded-2xl border shadow-sm flex flex-col items-center"><i class="fa-solid fa-poop text-orange-800 mb-1"></i><span class="text-[8px] font-bold">CACA</span></button>
        <button onclick="addCita()" class="bg-orange-500 text-white p-4 rounded-2xl shadow-lg flex flex-col items-center"><i class="fa-solid fa-calendar-plus mb-1"></i><span class="text-[8px] font-bold">CITA</span></button>
        <button onclick="quickLog('ðŸ¼ Toma')" class="bg-blue-600 text-white p-4 rounded-2xl shadow-lg flex flex-col items-center"><i class="fa-solid fa-bottle-water mb-1"></i><span class="text-[8px] font-bold">TOMA</span></button>
    </div>

    <div id="diario" class="space-y-2"></div>
</main>

<script>
// ... (Mantener auth, login y loadFamily de la V38.2) ...

function render() {
    const keys = Object.keys(familyData.children);
    const b = familyData.children[keys[bIdx]];
    
    // 1. Selector de BebÃ©
    document.getElementById('bebeSelector').innerHTML = keys.map((k, i) => 
        `<option value="${i}" ${i==bIdx?'selected':''}>${familyData.children[k].name.toUpperCase()}</option>`
    ).join('');
    document.getElementById('sub-info').innerText = `${familyData.name} â€¢ CÃ³digo: ${familyData.inviteCode}`;

    // 2. LÃ³gica de Citas (Visor 15 dÃ­as)
    const containerCitas = document.getElementById('visor-citas');
    const sectionCitas = document.getElementById('section-citas');
    const hoy = new Date();
    const limite = new Date();
    limite.setDate(hoy.getDate() + 15);

    const citasArr = Object.values(b.citas || {}).filter(c => {
        const fechaCita = new Date(c.fecha);
        return fechaCita >= hoy && fechaCita <= limite;
    }).sort((a,b) => new Date(a.fecha) - new Date(b.fecha));

    if(citasArr.length > 0) {
        sectionCitas.classList.remove('hidden');
        containerCitas.innerHTML = citasArr.map(c => `
            <div class="min-w-[160px] bg-white p-4 rounded-3xl border-l-4 border-orange-500 shadow-sm relative">
                <p class="text-[8px] font-black text-orange-500 uppercase">MÃ©dico</p>
                <p class="font-bold text-slate-800 text-xs truncate">${c.titulo}</p>
                <p class="text-[9px] text-slate-400 mt-1">${new Date(c.fecha).toLocaleDateString()}</p>
                <button onclick="deleteCita('${c.id}')" class="absolute top-2 right-2 text-slate-200 text-[10px]"><i class="fa-solid fa-xmark"></i></button>
            </div>
        `).join('');
    } else {
        sectionCitas.classList.add('hidden');
    }

    // 3. Diario
    const logs = Object.values(b.logs || {}).sort((a,b)=>b.ts - a.ts);
    if(logs[0]) document.getElementById('last-log').innerText = `${logs[0].txt} (${logs[0].h})`;
    
    document.getElementById('diario').innerHTML = logs.map(l => `
        <div class="bg-white p-4 rounded-2xl border flex justify-between items-center">
            <span class="font-bold text-slate-700 text-xs">${l.txt}</span>
            <span class="text-[9px] font-black text-slate-300 uppercase">${l.h}</span>
        </div>
    `).join('');
}

// NUEVA FUNCIÃ“N: AÃ‘ADIR CITA
function addCita() {
    const titulo = prompt("Â¿QuÃ© cita es? (Ej: Pediatra, Vacunas)");
    if(!titulo) return;
    const fecha = prompt("Fecha (AAAA-MM-DD):", new Date().toISOString().split('T')[0]);
    if(!fecha) return;

    const cid = Object.keys(familyData.children)[bIdx];
    const id = Date.now();
    db.ref(`familias/${familyId}/children/${cid}/citas/${id}`).set({
        id, titulo, fecha, ts: id
    });
}

function deleteCita(id) {
    const cid = Object.keys(familyData.children)[bIdx];
    if(confirm("Â¿Borrar cita?")) db.ref(`familias/${familyId}/children/${cid}/citas/${id}`).remove();
}

// ... (Mantener resto de funciones: quickLog, createFamily, etc.) ...
</script>
