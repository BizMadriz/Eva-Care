<!DOCTYPE html>  
<html lang="es">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>EvaCare V24.0 - Fix Final</title>  
    <script src="https://cdn.tailwindcss.com"></script>  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">  
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>  
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap');  
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }  
        .hidden { display: none !important; }  
        .reac-active { background: #dbeafe !important; border: 2px solid #2563eb !important; transform: scale(1.05); }
        .aviso-item { border-left: 4px solid #3b82f6; padding: 12px; margin-bottom: 8px; border-radius: 12px; background: rgba(0,0,0,0.05); }
    </style>  
</head>  
<body class="bg-slate-50 text-slate-900 pb-32">

<div id="setup-screen" class="fixed inset-0 bg-white z-[10000] flex flex-col items-center justify-center p-10 hidden">
    <div class="text-blue-600 text-5xl font-black italic mb-2 text-center">EvaCare</div>
    <p class="text-[10px] font-black text-slate-400 mb-8 uppercase tracking-[0.3em]">GestiÃ³n Familiar</p>
    <input id="family-id-input" type="text" placeholder="ID FAMILIAR" class="w-full p-6 bg-slate-100 rounded-[2rem] mb-4 font-bold text-center outline-none border-2 border-transparent focus:border-blue-500 uppercase">
    <button onclick="saveFamilyId()" class="w-full bg-blue-600 text-white p-6 rounded-[2rem] font-black shadow-xl uppercase">Entrar / Crear</button>
</div>

<div id="loading-screen" class="fixed inset-0 bg-white z-[9999] flex flex-col items-center justify-center">
    <div class="text-blue-600 text-4xl font-black italic animate-bounce">EvaCare</div>
</div>

<div id="app-content" class="hidden">
    <header class="p-6 flex justify-between items-center bg-white/80 sticky top-0 z-40 border-b border-slate-100 backdrop-blur-md">
        <div class="flex flex-col">
            <span class="text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1">Cuidando a:</span>
            <select id="bebe-selector" onchange="switchBebe(this.value)" class="bg-transparent font-black italic text-2xl outline-none text-blue-600 cursor-pointer"></select>
        </div>
        <button onclick="openModal('modal-menu')" class="w-12 h-12 bg-slate-50 rounded-full flex items-center justify-center text-slate-400"><i class="fa-solid fa-bars-staggered"></i></button>
    </header>

    <main id="tab-inicio" class="p-4 space-y-4">
        <div class="bg-slate-900 rounded-[2.5rem] p-7 text-white shadow-2xl">
            <h3 class="text-[9px] font-black text-blue-400 uppercase tracking-[0.2em] mb-4">Avisos de la Familia</h3>
            <div id="panel-avisos-global" class="space-y-3"></div>
        </div>

        <div id="lista-compra-global" class="space-y-2"></div>

        <div class="grid grid-cols-4 gap-3">
            <button onclick="addLog('ðŸ’¦ Pis')" class="bg-white py-6 rounded-[2rem] font-black text-cyan-600 text-[10px] border shadow-sm flex flex-col items-center gap-2"><i class="fa-solid fa-droplet text-lg"></i>PIS</button>
            <button onclick="addLog('ðŸ’© Caca')" class="bg-white py-6 rounded-[2rem] font-black text-orange-800 text-[10px] border shadow-sm flex flex-col items-center gap-2"><i class="fa-solid fa-poop text-lg"></i>CACA</button>
            <button onclick="addLog('âœ¨ Aseo')" class="bg-white py-6 rounded-[2rem] font-black text-purple-600 text-[10px] border shadow-sm flex flex-col items-center gap-2"><i class="fa-solid fa-sparkles text-lg"></i>ASEO</button>
            <button onclick="addCompra()" class="bg-yellow-400 text-slate-900 rounded-[2rem] flex items-center justify-center shadow-lg text-xl"><i class="fa-solid fa-cart-shopping"></i></button>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <button onclick="openModal('modal-pecho')" class="bg-white h-28 rounded-[2.5rem] border shadow-sm flex flex-col items-center justify-center"><i class="fa-solid fa-person-breastfeeding text-pink-500 mb-2 text-2xl"></i><span class="text-[10px] font-black uppercase">Pecho</span></button>
            <div class="space-y-3">
                <button onclick="openModal('modal-bibe')" class="w-full bg-white h-16 rounded-[1.8rem] border shadow-sm flex items-center justify-center gap-3"><i class="fa-solid fa-bottle-water text-blue-500 text-xl"></i><span class="text-[10px] font-black uppercase">BiberÃ³n</span></button>
                <button id="btn-repetir" onclick="repetirBibe()" class="w-full bg-blue-600 text-white h-9 rounded-full text-[9px] font-black uppercase hidden italic">Repetir Ãºltima</button>
            </div>
        </div>
        <div id="diario-hoy" class="space-y-2 pb-10"></div>
    </main>

    <main id="tab-nutricion" class="hidden p-4 space-y-5">
        <h2 class="text-3xl font-black italic text-orange-600 px-2">NutriciÃ³n</h2>
        <div class="bg-white p-7 rounded-[3rem] shadow-sm border space-y-5">
            <input id="food-input" type="text" placeholder="Â¿QuÃ© ha probado hoy?" class="w-full p-4 bg-slate-50 rounded-2xl font-bold border-none outline-none">
            <div class="flex justify-around bg-slate-50 p-3 rounded-2xl">
                <button onclick="setReac('ðŸ˜‹', this)" class="reac-btn p-4 rounded-xl text-3xl">ðŸ˜‹</button>
                <button onclick="setReac('ðŸ¤¢', this)" class="reac-btn p-4 rounded-xl text-3xl">ðŸ¤¢</button>
                <button onclick="setReac('âš ï¸', this)" class="reac-btn px-4 rounded-xl text-[10px] font-black text-red-500">ALERGIA</button>
            </div>
            <button onclick="saveFood()" class="w-full bg-orange-500 text-white p-5 rounded-2xl font-black uppercase">Guardar Registro</button>
        </div>
        <div id="lista-alimentos" class="space-y-2 pb-20"></div>
    </main>

    <main id="tab-salud" class="hidden p-4 space-y-6">
        <h2 class="text-3xl font-black italic text-indigo-600 px-2">Salud</h2>
        <div class="grid grid-cols-2 gap-4">
            <button onclick="openModal('modal-peso')" class="bg-white p-7 rounded-[2.5rem] border shadow-sm flex flex-col items-center"><i class="fa-solid fa-weight-scale text-indigo-500 mb-2 text-2xl"></i><span id="cur-peso" class="font-black text-xl">--.- kg</span></button>
            <button onclick="openModal('modal-peso')" class="bg-white p-7 rounded-[2.5rem] border shadow-sm flex flex-col items-center"><i class="fa-solid fa-ruler-vertical text-indigo-500 mb-2 text-2xl"></i><span id="cur-altura" class="font-black text-xl">-- cm</span></button>
        </div>
        <button onclick="openModal('modal-med')" class="w-full bg-indigo-600 text-white p-5 rounded-[2rem] font-black uppercase">Nueva Medicina</button>
        <div id="lista-meds" class="space-y-3 pb-20"></div>
    </main>

    <nav class="fixed bottom-6 left-6 right-6 h-18 bg-white/90 backdrop-blur-xl rounded-full border shadow-2xl flex justify-around items-center z-50">  
        <button onclick="showTab('inicio')" id="nav-inicio" class="text-blue-600 p-4"><i class="fa-solid fa-house-chimney text-2xl"></i></button>  
        <button onclick="showTab('nutricion')" id="nav-nutricion" class="text-slate-300 p-4"><i class="fa-solid fa-carrot text-2xl"></i></button>  
        <button onclick="showTab('salud')" id="nav-salud" class="text-slate-300 p-4"><i class="fa-solid fa-suitcase-medical text-2xl"></i></button>  
    </nav>
</div>

<div id="modal-bibe" class="hidden fixed inset-0 bg-black/80 z-[11000] flex items-center justify-center p-6"><div class="bg-white w-full rounded-[3rem] p-10 space-y-5"><input id="in-ml" type="number" placeholder="ml" class="w-full p-8 bg-slate-100 rounded-3xl text-center text-6xl font-black outline-none"><button onclick="addBibe()" class="w-full bg-blue-600 text-white p-6 rounded-3xl font-black uppercase">Guardar</button><button onclick="closeModal('modal-bibe')" class="w-full text-slate-400 font-bold text-xs uppercase">Cancelar</button></div></div>
<div id="modal-pecho" class="hidden fixed inset-0 bg-black/80 z-[11000] flex items-end"><div class="bg-white w-full p-10 rounded-t-[4rem] grid grid-cols-3 gap-4 shadow-2xl"><button onclick="addLog('ðŸ¤± Izquierdo', true); closeModal('modal-pecho')" class="bg-pink-50 p-8 rounded-3xl font-black text-pink-600 text-[10px]">IZQ</button><button onclick="addLog('ðŸ¤± Ambos', true); closeModal('modal-pecho')" class="bg-pink-600 p-8 rounded-3xl font-black text-white text-[10px]">AMBOS</button><button onclick="addLog('ðŸ¤± Derecho', true); closeModal('modal-pecho')" class="bg-pink-50 p-8 rounded-3xl font-black text-pink-600 text-[10px]">DER</button></div></div>
<div id="modal-peso" class="hidden fixed inset-0 bg-black/80 z-[11000] flex items-center justify-center p-6"><div class="bg-white w-full rounded-[3rem] p-10 space-y-5"><input id="in-kg" type="number" step="0.01" placeholder="Peso (kg)" class="w-full p-5 bg-slate-50 rounded-2xl font-bold text-center text-2xl"><input id="in-cm" type="number" placeholder="Altura (cm)" class="w-full p-5 bg-slate-50 rounded-2xl font-bold text-center text-2xl"><button onclick="savePeso()" class="w-full bg-indigo-600 text-white p-5 rounded-2xl font-black uppercase">Guardar</button><button onclick="closeModal('modal-peso')" class="w-full text-slate-400 font-bold text-xs uppercase">Cerrar</button></div></div>
<div id="modal-med" class="hidden fixed inset-0 bg-black/80 z-[11000] flex items-center justify-center p-6"><div class="bg-white w-full rounded-[3rem] p-10 space-y-4"><input id="m-name" type="text" placeholder="Medicamento" class="w-full p-4 bg-slate-50 rounded-xl font-bold"><input id="m-dose" type="text" placeholder="Dosis" class="w-full p-4 bg-slate-50 rounded-xl font-bold"><button onclick="saveMed()" class="w-full bg-indigo-600 text-white p-5 rounded-2xl font-black uppercase">AÃ±adir</button><button onclick="closeModal('modal-med')" class="w-full text-slate-400 font-bold text-xs uppercase">Cerrar</button></div></div>
<div id="modal-menu" class="hidden fixed inset-0 bg-black/80 z-[11000] flex justify-end"><div class="bg-white w-4/5 h-full p-10 flex flex-col"><h2 class="text-3xl font-black mb-10">Ajustes</h2><div class="space-y-6 flex-1 overflow-y-auto"><div class="bg-slate-50 p-6 rounded-[2rem]"><label class="text-[9px] font-black text-blue-600 uppercase">AÃ±adir BebÃ©</label><input type="text" id="new-n" placeholder="Nombre" class="w-full p-4 bg-white rounded-2xl mt-2 font-bold outline-none"><button onclick="addNewBebe()" class="w-full bg-blue-600 text-white p-4 rounded-2xl mt-3 font-black text-[10px]">AÃ‘ADIR</button></div><button onclick="localStorage.clear();location.reload()" class="w-full text-red-500 font-black text-[10px] uppercase p-6 rounded-3xl bg-red-50">Cerrar SesiÃ³n</button></div><button onclick="closeModal('modal-menu')" class="mt-4 p-4 text-slate-300 font-black">VOLVER</button></div></div>

<script>
    const fbCfg = { apiKey: "AIzaSyAvFcHDaFUg_sPWyN6YmdMRJe3YiEHaq0I", databaseURL: "https://evacare-24cae-default-rtdb.firebaseio.com", projectId: "evacare-24cae" };
    firebase.initializeApp(fbCfg); const db = firebase.database();

    let DATA = null, familyId = localStorage.getItem('EVA_CARE_FAMILY_ID'), bIdx = parseInt(localStorage.getItem('EVA_CARE_BEBE_IDX') || 0), curReac = "";

    function saveFamilyId() {
        const id = document.getElementById('family-id-input').value.trim().toUpperCase();
        if(id) { localStorage.setItem('EVA_CARE_FAMILY_ID', id); location.reload(); }
    }

    function init() {
        if(!familyId) {
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('setup-screen').classList.remove('hidden');
            return;
        }
        db.ref('familias/' + familyId).on('value', snap => {
            DATA = snap.val();
            if(!DATA) {
                DATA = { intervalo: 3, compraFamiliar: [], bebes: [{ n: "BebÃ© 1", logs: [], meds: [], foods: [], hPeso: [], lastToma: Date.now() }] };
                db.ref('familias/' + familyId).set(DATA);
            }
            if(!DATA.bebes[bIdx]) bIdx = 0;
            render();
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('app-content').classList.remove('hidden');
        }, err => { alert("Error de conexiÃ³n"); });
    }

    function sync() { if(familyId && DATA) db.ref('familias/' + familyId).set(DATA); }

    function render() {
        if(!DATA) return;
        const b = DATA.bebes[bIdx];
        document.getElementById('bebe-selector').innerHTML = DATA.bebes.map((x,i)=>`<option value="${i}" ${i===bIdx?'selected':''}>${x.n.toUpperCase()}</option>`).join('');

        // Avisos Globales
        let htmlAvisos = "";
        DATA.bebes.forEach(bebe => {
            const prox = (bebe.lastToma || 0) + (DATA.intervalo * 3600000);
            if(prox < Date.now()) htmlAvisos += `<div class="aviso-item border-red-500 text-red-600 font-bold text-[11px]">${bebe.n}: Toca toma</div>`;
        });
        document.getElementById('panel-avisos-global').innerHTML = htmlAvisos || '<p class="text-[9px] text-blue-400 font-black text-center uppercase">Sin alertas</p>';

        // Compra
        document.getElementById('lista-compra-global').innerHTML = (DATA.compraFamiliar || []).map((x,i)=>`
            <div class="bg-yellow-100 p-4 rounded-3xl flex justify-between items-center text-[10px] font-black uppercase text-yellow-800">
                <span>ðŸ›’ ${x.txt}</span>
                <button onclick="DATA.compraFamiliar.splice(${i},1);sync()" class="bg-yellow-500 text-white w-7 h-7 rounded-full"><i class="fa-solid fa-check"></i></button>
            </div>`).join('');

        // Diarios y Otros
        document.getElementById('diario-hoy').innerHTML = (b.logs||[]).slice(0,10).map(l=>`<div class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm mb-2 border-b"><span>${l.txt}</span><span class="text-[9px] opacity-30">${l.h}</span></div>`).join('');
        document.getElementById('cur-peso').innerText = b.peso ? b.peso+"kg" : "--.- kg";
        document.getElementById('cur-altura').innerText = b.altura ? b.altura+"cm" : "-- cm";
        document.getElementById('lista-meds').innerHTML = (b.meds||[]).map((m,i)=>`<div class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center"><p class="font-black text-xs">${m.n} (${m.d})</p><button onclick="DATA.bebes[bIdx].meds.splice(${i},1);sync()" class="text-red-300"><i class="fa-solid fa-trash"></i></button></div>`).join('');
        document.getElementById('lista-alimentos').innerHTML = (b.foods||[]).map(f=>`<div class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border-l-4 border-orange-400 text-xs font-bold"><span>${f.n}</span><span>${f.r}</span></div>`).join('');

        const btnRep = document.getElementById('btn-repetir');
        if(b.lastMl) { btnRep.innerText=`Repetir ${b.lastMl}ml`; btnRep.classList.remove('hidden'); } else { btnRep.classList.add('hidden'); }
    }

    // ACCIONES
    function addLog(txt, resets = false) {
        const b = DATA.bebes[bIdx]; if(!b.logs) b.logs = [];
        const entry = { txt, h: new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}), ts: Date.now() };
        b.logs.unshift(entry); if(resets) b.lastToma = entry.ts; sync();
    }
    function addBibe() { const ml = document.getElementById('in-ml').value; if(ml){ addLog(`ðŸ¼ BiberÃ³n ${ml}ml`, true); DATA.bebes[bIdx].lastMl = ml; closeModal('modal-bibe'); document.getElementById('in-ml').value=""; } }
    function repetirBibe() { if(DATA.bebes[bIdx].lastMl) addLog(`ðŸ¼ BiberÃ³n ${DATA.bebes[bIdx].lastMl}ml`, true); }
    function addCompra() { const item = prompt("Necesito..."); if(item){ if(!DATA.compraFamiliar) DATA.compraFamiliar = []; DATA.compraFamiliar.push({txt:item}); sync(); } }
    function savePeso() { const kg = document.getElementById('in-kg').value, cm = document.getElementById('in-cm').value; if(kg){ DATA.bebes[bIdx].peso=kg; DATA.bebes[bIdx].altura=cm||DATA.bebes[bIdx].altura; closeModal('modal-peso'); sync(); } }
    function saveMed() { const n = document.getElementById('m-name').value, d = document.getElementById('m-dose').value; if(n){ if(!DATA.bebes[bIdx].meds) DATA.bebes[bIdx].meds = []; DATA.bebes[bIdx].meds.push({n,d}); closeModal('modal-med'); sync(); } }
    function saveFood() { const n = document.getElementById('food-input').value; if(n){ if(!DATA.bebes[bIdx].foods) DATA.bebes[bIdx].foods = []; DATA.bebes[bIdx].foods.push({n, r:curReac||'â“'}); document.getElementById('food-input').value=""; curReac=""; document.querySelectorAll('.reac-btn').forEach(x=>x.classList.remove('reac-active')); sync(); } }
    function addNewBebe() { const n = document.getElementById('new-n').value; if(n) { DATA.bebes.push({n, logs:[], meds:[], foods:[], hPeso:[], lastToma:Date.now()}); sync(); closeModal('modal-menu'); } }
    function switchBebe(v) { bIdx = parseInt(v); localStorage.setItem('EVA_CARE_BEBE_IDX', v); render(); }
    function showTab(t) { document.querySelectorAll('main').forEach(m=>m.classList.add('hidden')); document.getElementById('tab-'+t).classList.remove('hidden'); document.querySelectorAll('nav button').forEach(b=>b.className='text-slate-300 p-4'); document.getElementById('nav-'+t).className='text-blue-600 p-4 scale-110'; }
    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
    function setReac(r, b) { curReac = r; document.querySelectorAll('.reac-btn').forEach(x=>x.classList.remove('reac-active')); b.classList.add('reac-active'); }

    init();
</script>
</body>
</html>
