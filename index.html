<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EvaCare V30 Full - Auth + Tabs</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap');
body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
.hidden { display: none !important; }
.reac-active { background: #dbeafe !important; border: 2px solid #2563eb !important; transform: scale(1.1); }
.aviso-item { border-left: 4px solid #3b82f6; padding: 6px 12px; margin-bottom: 8px; border-radius: 8px; background: rgba(255,255,255,0.08); }
.no-scrollbar::-webkit-scrollbar { display: none; }
</style>
</head>
<body class="bg-slate-50 text-slate-900 pb-32">

<!-- LOGIN -->
<div id="login-screen" class="fixed inset-0 bg-white z-[20000] flex flex-col items-center justify-center p-10">
  <h1 class="text-5xl font-black italic text-blue-600 mb-6">EvaCare</h1>
  <input id="email" type="email" placeholder="Email" class="w-full p-5 bg-slate-100 rounded-2xl mb-3 font-bold">
  <input id="password" type="password" placeholder="ContraseÃ±a" class="w-full p-5 bg-slate-100 rounded-2xl mb-6 font-bold">
  <button onclick="login()" class="w-full bg-blue-600 text-white p-5 rounded-2xl font-black mb-3">ENTRAR</button>
  <button onclick="register()" class="text-blue-600 text-sm font-bold">Crear cuenta</button>
</div>

<!-- LOADING -->
<div id="loading-screen" class="fixed inset-0 bg-white z-[19999] flex flex-col items-center justify-center p-6 hidden">
  <div class="text-blue-600 text-4xl font-black italic animate-bounce mb-4">EvaCare</div>
  <div id="status-msg" class="text-slate-400 text-[10px] uppercase tracking-widest">Conectando...</div>
</div>

<!-- APP CONTENT -->
<div id="app-content" class="hidden">

<header class="p-6 flex justify-between items-center bg-white/80 sticky top-0 z-50 border-b backdrop-blur-md">
  <div class="flex flex-col">
    <span class="text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1">Familia:</span>
    <h1 id="display-id" class="text-xl font-black italic text-blue-600">---</h1>
  </div>
  <button onclick="logout()" class="text-[10px] font-black text-red-400 bg-red-50 px-4 py-2 rounded-full">SALIR</button>
</header>

<!-- NAV -->
<nav class="fixed bottom-6 left-6 right-6 h-18 bg-white/90 backdrop-blur-xl rounded-full border shadow-2xl flex justify-around items-center z-50">
  <button onclick="showTab('inicio')" id="nav-inicio" class="text-blue-600 p-4"><i class="fa-solid fa-house-chimney text-2xl"></i></button>
  <button onclick="showTab('nutricion')" id="nav-nutricion" class="text-slate-300 p-4"><i class="fa-solid fa-carrot text-2xl"></i></button>
  <button onclick="showTab('salud')" id="nav-salud" class="text-slate-300 p-4"><i class="fa-solid fa-suitcase-medical text-2xl"></i></button>
  <button onclick="showTab('cal')" id="nav-cal" class="text-slate-300 p-4"><i class="fa-solid fa-calendar-day text-2xl"></i></button>
</nav>

<!-- MAIN TABS -->
<main id="tab-inicio" class="p-4 space-y-4">
  <div class="bg-slate-900 rounded-[2.5rem] p-7 text-white shadow-2xl">
    <h3 class="text-[9px] font-black text-blue-400 uppercase tracking-[0.2em] mb-4">Avisos de la Familia</h3>
    <div id="panel-avisos-global" class="space-y-3"></div>
  </div>
  <div id="lista-compra-global" class="space-y-2"></div>
  <div class="grid grid-cols-4 gap-3">
    <button onclick="addLog('ðŸ’¦ Pis')" class="bg-white py-6 rounded-[2rem] font-black text-cyan-600 text-[10px] border shadow-sm flex flex-col items-center gap-2"><i class="fa-solid fa-droplet text-lg"></i>PIS</button>
    <button onclick="addLog('ðŸ’© Caca')" class="bg-white py-6 rounded-[2rem] font-black text-orange-800 text-[10px] border shadow-sm flex flex-col items-center gap-2"><i class="fa-solid fa-poop text-lg"></i>CACA</button>
    <button onclick="addLog('âœ¨ Aseo')" class="bg-white py-6 rounded-[2rem] font-black text-purple-600 text-[10px] border shadow-sm flex flex-col items-center gap-2"><i class="fa-solid fa-sparkles text-lg"></i>ASEO</button>
    <button onclick="addCompra()" class="bg-yellow-400 text-slate-900 rounded-[2rem] flex items-center justify-center shadow-lg text-xl"><i class="fa-solid fa-cart-shopping"></i></button>
  </div>
  <div class="grid grid-cols-2 gap-4">
    <button onclick="openModal('modal-pecho')" class="bg-white h-28 rounded-[2.5rem] border shadow-sm flex flex-col items-center justify-center">
      <i class="fa-solid fa-person-breastfeeding text-pink-500 mb-2 text-2xl"></i>
      <span class="text-[10px] font-black uppercase">Pecho</span>
    </button>
    <div class="space-y-3">
      <button onclick="openModal('modal-bibe')" class="w-full bg-white h-16 rounded-[1.8rem] border shadow-sm flex items-center justify-center gap-3">
        <i class="fa-solid fa-bottle-water text-blue-500 text-xl"></i>
        <span class="text-[10px] font-black uppercase">BiberÃ³n</span>
      </button>
      <button id="btn-repetir" onclick="repetirBibe()" class="w-full bg-blue-600 text-white h-9 rounded-full text-[9px] font-black uppercase shadow-md hidden italic tracking-tighter">Repetir Ãºltima</button>
    </div>
  </div>
  <div id="diario-hoy" class="space-y-2 pb-10"></div>
</main>

<main id="tab-nutricion" class="hidden p-4 space-y-5">
  <h2 class="text-3xl font-black italic text-orange-600 px-2">AlimentaciÃ³n</h2>
  <div class="bg-white p-7 rounded-[3rem] shadow-sm border space-y-5">
    <input id="food-input" type="text" placeholder="Â¿QuÃ© ha probado hoy?" class="w-full p-5 bg-slate-50 rounded-2xl font-bold outline-none">
    <div class="flex justify-around bg-slate-50 p-3 rounded-2xl">
      <button onclick="setReac('ðŸ˜‹', this)" class="reac-btn p-4 rounded-xl text-3xl">ðŸ˜‹</button>
      <button onclick="setReac('ðŸ¤¢', this)" class="reac-btn p-4 rounded-xl text-3xl">ðŸ¤¢</button>
      <button onclick="setReac('âš ï¸', this)" class="reac-btn px-4 rounded-xl text-[10px] font-black text-red-500">ALERGIA</button>
    </div>
    <button onclick="saveFood()" class="w-full bg-orange-500 text-white p-5 rounded-2xl font-black">GUARDAR REGISTRO</button>
  </div>
  <div id="lista-alimentos" class="space-y-2"></div>
</main>

<main id="tab-salud" class="hidden p-4 space-y-6">
  <h2 class="text-3xl font-black italic text-indigo-600 px-2">Salud</h2>
  <div class="grid grid-cols-2 gap-4">
    <button onclick="openModal('modal-peso')" class="bg-white p-7 rounded-[2.5rem] border shadow-sm flex flex-col items-center">
      <i class="fa-solid fa-weight-scale text-indigo-500 mb-2 text-2xl"></i>
      <span id="cur-peso" class="font-black text-xl">--.- kg</span>
    </button>
    <button onclick="openModal('modal-peso')" class="bg-white p-7 rounded-[2.5rem] border shadow-sm flex flex-col items-center">
      <i class="fa-solid fa-ruler-vertical text-indigo-500 mb-2 text-2xl"></i>
      <span id="cur-altura" class="font-black text-xl">-- cm</span>
    </button>
  </div>
  <div id="lista-meds" class="space-y-3"></div>
</main>

<main id="tab-cal" class="hidden p-4 space-y-6">
  <h2 class="text-3xl font-black italic text-blue-600 px-2">Agenda</h2>
  <div id="agenda-lista" class="space-y-3"></div>
</main>

<!-- MODALES -->
<div id="modal-bibe" class="hidden fixed inset-0 bg-black/80 z-[11000] flex items-center justify-center p-6">
  <div class="bg-white w-full rounded-[3rem] p-10 space-y-5">
    <input id="in-ml" type="number" placeholder="ml" class="w-full p-8 bg-slate-100 rounded-3xl text-center text-6xl font-black outline-none">
    <button onclick="addBibe()" class="w-full bg-blue-600 text-white p-6 rounded-3xl font-black">GUARDAR</button>
    <button onclick="closeModal('modal-bibe')" class="w-full text-slate-400 font-bold text-[10px]">CANCELAR</button>
  </div>
</div>

<div id="modal-pecho" class="hidden fixed inset-0 bg-black/80 z-[11000] flex items-end">
  <div class="bg-white w-full p-10 rounded-t-[4rem] grid grid-cols-3 gap-4 shadow-2xl">
    <button onclick="addLog('ðŸ¤± Izquierdo', true); closeModal('modal-pecho')" class="bg-pink-50 p-8 rounded-3xl font-black text-pink-600 text-[10px]">IZQUIERDO</button>
    <button onclick="addLog('ðŸ¤± Ambos', true); closeModal('modal-pecho')" class="bg-pink-600 p-8 rounded-3xl font-black text-white text-[10px]">AMBOS</button>
    <button onclick="addLog('ðŸ¤± Derecho', true); closeModal('modal-pecho')" class="bg-pink-50 p-8 rounded-3xl font-black text-pink-600 text-[10px]">DERECHO</button>
  </div>
</div>

<script>
const db=firebase.database(); const auth=firebase.auth();
let currentUser=null,familyId=null,DATA=null,bIdx=0,curReac="";

function login(){const e=email.value.trim(),p=password.value.trim();if(!e||!p)return alert("Completa email y contraseÃ±a");auth.signInWithEmailAndPassword(e,p).catch(err=>alert(err.message));}
function register(){const e=email.value.trim(),p=password.value.trim();if(!e||!p)return alert("Completa email y contraseÃ±a");auth.createUserWithEmailAndPassword(e,p).catch(err=>alert(err.message));}
function logout(){auth.signOut();location.reload();}

auth.onAuthStateChanged(async user=>{
if(!user)return;currentUser=user;
const userSnap=await db.ref('users/'+user.uid).once('value');
if(!userSnap.exists()){
  familyId='FAM_'+Math.random().toString(36).substr(2,6).toUpperCase();
  await db.ref('users/'+user.uid).set({email:user.email,familyId});
  await db.ref('familias/'+familyId).set({
    owner:user.uid,
    members:{[user.uid]:true},
    data:{intervalo:3,compraFamiliar:[],bebes:[{n:"Mi BebÃ©",f:new Date().toISOString().split('T')[0],logs:[],meds:[],foods:[],citas:{},hPeso:[]}]}
  });
} else familyId=userSnap.val().familyId;
document.getElementById('login-screen').classList.add('hidden');
document.getElementById('loading-screen').classList.remove('hidden');
document.getElementById('status-msg').innerText="Cargando datos de "+familyId;
document.getElementById('display-id').innerText=familyId;
startApp();
});

function startApp(){
db.ref(`familias/${familyId}/data`).on('value',snap=>{
DATA=snap.val(); render();
document.getElementById('loading-screen').classList.add('hidden');
document.getElementById('app-content').classList.remove('hidden');
});
}

function render(){if(!DATA)return;
const b=DATA.bebes[bIdx];
// Avisos
let htmlAvisos="";
DATA.bebes.forEach(be=>(be.meds||[]).forEach(m=>htmlAvisos+=`<div class="aviso-item"><span class="text-purple-400 font-black">${be.n}:</span> ${m.n}</div>`));
document.getElementById('panel-avisos-global').innerHTML=htmlAvisos||'<p class="text-[10px] text-slate-500 italic">Todo en orden</p>';
}

function addLog(txt,resets=false){const b=DATA.bebes[bIdx];if(!b.logs)b.logs=[];const entry={txt,h:new Date().toLocaleTimeString(),ts:Date.now()};b.logs.unshift(entry);if(resets)b.lastToma=entry.ts;sync();}
function addBibe(){const ml=document.getElementById('in-ml').value;if(ml){addLog(`ðŸ¼ BiberÃ³n ${ml}ml`,true);DATA.bebes[bIdx].lastMl=ml;closeModal('modal-bibe');document.getElementById('in-ml').value="";}}
function repetirBibe(){if(DATA.bebes[bIdx].lastMl)addLog(`ðŸ¼ BiberÃ³n ${DATA.bebes[bIdx].lastMl}ml`,true);}
function addCompra(){const item=prompt("Necesito...");if(item){if(!DATA.compraFamiliar)DATA.compraFamiliar=[];DATA.compraFamiliar.push({txt:item,para:DATA.bebes[bIdx].n});sync();}}
function sync(){db.ref(`familias/${familyId}/data`).set(DATA);}
function openModal(id){document.getElementById(id).classList.remove('hidden');}
function closeModal(id){document.getElementById(id).classList.add('hidden');}
function showTab(t){document.querySelectorAll('main').forEach(m=>m.classList.add('hidden'));document.getElementById('tab-'+t).classList.remove('hidden');document.querySelectorAll('nav button').forEach(b=>b.className='text-slate-300 p-4');document.getElementById('nav-'+t).className='text-blue-600 p-4';}
function setReac(r,b){curReac=r;document.querySelectorAll('.reac-btn').forEach(x=>x.classList.remove('reac-active'));b.classList.add('reac-active');}
function saveFood(){const n=document.getElementById('food-input').value;if(n){if(!DATA.bebes[bIdx].foods)DATA.bebes[bIdx].foods=[];DATA.bebes[bIdx].foods.push({n,r:curReac||'â“'});document.getElementById('food-input').value="";curReac="";document.querySelectorAll('.reac-btn').forEach(x=>x.classList.remove('reac-active'));sync();}}
</script>
</body>
</html>
